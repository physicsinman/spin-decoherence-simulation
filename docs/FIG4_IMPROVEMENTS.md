# Figure 4 개선 사항 및 문제 해결

## 발견된 문제들

### 1. 왼쪽 위 그래프 (τc = 0.01 μs)에 Echo 곡선이 보이지 않았던 이유

**원인:**
- Echo 데이터의 시간 범위가 **0.001 ~ 0.300 μs**에만 존재
- 기존 코드는 모든 패널에 **0-3 μs** 범위를 고정으로 사용
- Echo 데이터가 0.3 μs까지만 있어서 그래프에서 거의 보이지 않음
- 또한 FID와 Echo가 거의 겹쳐서 구분이 어려움

**해결:**
- 각 tau_c 값에 맞게 **동적 x축 범위** 설정
- 작은 tau_c의 경우 최소 1.5 μs까지 표시하여 Echo 데이터를 명확히 보이도록 함
- y축 범위를 조정하여 FID와 Echo의 미세한 차이도 볼 수 있도록 개선

### 2. 오른쪽 아래 그래프 (τc = 10.00 μs)가 중간에 끊겨 보였던 이유

**원인:**
- Echo 데이터의 시간 범위가 **1.000 ~ 400.000 μs**
- 기존 코드는 **0-3 μs** 범위만 표시
- Echo 데이터가 1 μs부터 시작하므로 그래프에서 1-3 μs 구간만 보임
- 이로 인해 곡선이 중간에 끊겨 보이는 것처럼 보였음

**해결:**
- 각 tau_c 값에 맞게 **최적의 x축 범위** 자동 계산
- 큰 tau_c의 경우 Echo peak가 발생하는 구간(약 0-5 μs)에 집중
- 데이터가 더 길게 연장되는 경우 주석으로 표시

## 주요 개선 사항

### 1. 동적 x축 범위 설정
```python
# 각 tau_c에 맞게 최적 범위 계산
if tau_c_val <= 1e-7:
    x_max = max(x_max, 1.5)  # 작은 tau_c: 최소 1.5 μs
elif tau_c_val >= 1e-6:
    x_max = min(x_max, 5.0)   # 큰 tau_c: 최대 5 μs
else:
    x_max = min(x_max, 3.5)   # 중간: 최대 3.5 μs
```

### 2. Echo Peak 표시
- Echo peak 위치를 자동으로 찾아서 마커로 표시
- Peak 시간과 값을 주석으로 표시
- 화살표와 텍스트 박스로 명확히 표시

### 3. 시각적 품질 개선
- 선 두께 증가 (2.0 → 2.5)
- 그림 크기 증가 (14×12 → 16×13)
- 색상 대비 개선
- 그리드 투명도 조정
- 범례 위치 및 스타일 개선

### 4. 데이터 범위 표시
- Echo 데이터가 표시 범위를 넘어가는 경우 주석으로 표시
- 실제 데이터 범위를 명확히 알 수 있도록 함

## 데이터 범위 요약

| τc 값 | FID 시간 범위 | Echo 시간 범위 | Echo Peak 위치 |
|-------|--------------|----------------|----------------|
| 1e-8 (0.01 μs) | 0.000 ~ 12.913 μs | 0.001 ~ 0.300 μs | 0.001 μs |
| 1e-7 (0.10 μs) | 0.000 ~ 1.291 μs | 0.010 ~ 2.000 μs | 0.010 μs |
| 1e-6 (1.00 μs) | 0.000 ~ 3.400 μs | 0.100 ~ 40.000 μs | 0.100 μs |
| 1e-5 (10.00 μs) | 0.000 ~ 3.400 μs | 1.000 ~ 400.000 μs | 1.000 μs |

## 개선된 그래프의 특징

1. **모든 패널에서 FID와 Echo 곡선이 명확히 보임**
2. **각 tau_c에 최적화된 시간 범위로 표시**
3. **Echo peak가 명확히 표시됨**
4. **데이터 범위가 명확히 표시됨**
5. **논문 출판 품질의 시각적 완성도**

## 기술적 세부사항

### 문제 해결 과정
1. 데이터 파일의 실제 시간 범위 확인
2. 각 tau_c별 최적 표시 범위 계산
3. Echo peak 자동 탐지 및 표시
4. 동적 축 범위 설정 로직 구현
5. 시각적 품질 개선

### 코드 변경 사항
- `plot_representative_curves()` 함수 전체 재작성
- 동적 범위 계산 로직 추가
- Echo peak 탐지 및 표시 기능 추가
- 데이터 범위 주석 기능 추가
- 시각적 스타일 개선

